 @model Reservation.Models.ViewModels.RestaurantListViewModel
@{
    ViewData["Title"] = "餐廳列表";
}

<!-- 頂部漸層導航欄 -->
<header class="restaurant-header">
    <div class="header-content">
        <h1 class="header-title">@(Model.SelectedBranchId.HasValue ? 
            Model.Branches.FirstOrDefault(b => b.Id == Model.SelectedBranchId)?.Name ?? "遠百信義A13" 
            : "遠百信義A13")</h1>
    </div>
</header>
<!-- 搜尋與篩選區域 -->
<div class="search-filter-section">
    <div class="container-fluid px-3 py-3">
        <!-- 分店選擇 -->
        <div class="row mb-3">
            <div class="col-md-4 col-6 mb-2">
                <div class="dropdown">
                    <button class="btn btn-primary dropdown-toggle w-100 text-start unified-control" type="button" 
                            id="branchDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                        <span id="selectedBranchText">@(Model.SelectedBranchId.HasValue ? Model.Branches.FirstOrDefault(b => b.Id == Model.SelectedBranchId)?.Name ?? "分店選擇" : "分店選擇")</span>
                        <span class="dropdown-arrow-wrapper">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                                <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/>
                            </svg>
                        </span>
                    </button>
                    <ul class="dropdown-menu w-100" aria-labelledby="branchDropdown">
                        <li><a class="dropdown-item" href="@Url.Action("Index", new { categoryId = Model.SelectedCategoryId })">所有分店</a></li>
                        @foreach (var branch in Model.Branches)
                        {
                            <li>
                                <a class="dropdown-item @(Model.SelectedBranchId == branch.Id ? "active" : "")" 
                                   href="@Url.Action("Index", new { branchId = branch.Id, categoryId = Model.SelectedCategoryId })">
                                    @branch.Name
                                </a>
                            </li>
                        }
                    </ul>
                </div>
            </div>
            <div class="col-md-8 col-6 mb-2">
                <a href="@Url.Action("QueryRecord", "Restaurant")" 
                   class="w-100 unified-control d-flex align-items-center justify-content-center text-secondary text-decoration-none" 
                   style="border: none; padding: 0.5rem 0;">
                    <img src="@Url.Content("~/Image/icon.png")" alt="訂候位紀錄查詢" class="me-2" style="width: 20px; height: 20px;">
                    <span style="border-bottom: 1px solid #6c757d;">訂候位紀錄查詢</span>
                </a>
            </div>
        </div>

        <!-- 類別篩選 -->
        <div class="category-filter">
            @foreach (var category in Model.Categories)
            {
                var isActive = (Model.SelectedCategoryId == category.Id) || 
                              (!Model.SelectedCategoryId.HasValue && category.Id == 0);
                <a href="@Url.Action("Index", new { branchId = Model.SelectedBranchId, categoryId = category.Id == 0 ? (int?)null : category.Id })" 
                   class="category-tag @(isActive ? "active" : "")">
                    @category.Name
                </a>
                @if (category != Model.Categories.Last())
                {
                    <span class="category-separator">|</span>
                }
            }
        </div>
    </div>
</div>

<!-- 餐廳列表 -->
<div class="restaurant-list-section">
    <div class="container-fluid px-3">
        @if (Model.Restaurants != null && Model.Restaurants.Any())
        {
            @foreach (var restaurant in Model.Restaurants)
            {
                <div class="restaurant-card">
                    <div class="row g-0">
                        <!-- 左側圖片 -->
                        <div class="col-md-3 col-4">
                            <div class="restaurant-image-wrapper">
                                <img src="@Url.Content(restaurant.ImageUrl)"  class="restaurant-image" />
                            </div>
                        </div>
                        <!-- 右側資訊 -->
                        <div class="col-md-9 col-8">
                            <div class="restaurant-info">
                                <h3 class="restaurant-name">@restaurant.Name</h3>
                                <div class="restaurant-details">
                                    <div class="detail-item">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#258cfb" viewBox="0 0 16 16" class="detail-icon">
                                            <path d="M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10zm0-7a3 3 0 1 1 0-6 3 3 0 0 1 0 6z"/>
                                        </svg>
                                        <span>@restaurant.Location</span>
                                    </div>
                                    <div class="detail-item">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#258cfb" viewBox="0 0 16 16" class="detail-icon">
                                            <path d="M3.654 1.328a.678.678 0 0 0-1.015-.063L1.605 2.3c-.483.484-.661 1.169-.45 1.77a17.568 17.568 0 0 0 4.168 6.608 17.569 17.569 0 0 0 6.608 4.168c.601.211 1.286.033 1.77-.45l1.034-1.034a.678.678 0 0 0-.063-1.015l-2.307-1.794a.678.678 0 0 0-.58-.122L9.78 10.22a.678.678 0 0 1-.58-.122L6.5 7.5a.678.678 0 0 1-.122-.58l.122-1.034a.678.678 0 0 0-.122-.58L3.654 1.328z"/>
                                        </svg>
                                        <span>@restaurant.Phone</span>
                                    </div>
                                </div>
                                <div class="restaurant-actions">
                                    <a href="@Url.Action("Index", "Reservation", new { id = restaurant.Id })" 
                                       class="btn btn-outline-primary btn-reservation">訂位</a>
                                    <a href="@Url.Action("Index", "WaitingPosition", new { id = restaurant.Id })" 
                                       class="btn btn-outline-secondary btn-queue">候位</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            }
        }
        else
        {
            <div class="text-center py-5">
                <p class="text-muted">目前沒有符合條件的餐廳</p>
            </div>
        }
    </div>
</div>

@section Scripts {
    <script>
        // 分店選擇按鈕文字已在 HTML 中直接設置，無需 JavaScript 更新
    </script>
}


